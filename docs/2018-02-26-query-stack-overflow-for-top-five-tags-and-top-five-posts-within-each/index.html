<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.36.1" />
  <meta name="author" content="Tim Trice">

  
  
  
  
    
      
    
  
  <meta name="description" content="I want to build a query to find the top 5 tags on Stack Overflow and the top 5 posts within each tag. This is a somewhat simple query that utilizes two subqueries AND OVER PARTITION statements.
 Get the top 5 tags (by post count). Get the top 5 posts (by score) for each tag.  I use the Stack Exchange Data Explorer. The tables I focus on are:">

  
  <link rel="alternate" hreflang="en-us" href="../2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each/">

  


  

  
  
  <meta name="theme-color" content="#795548">
  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="../styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-1507390-26', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="Tim Trice">
  <link rel="feed" href="../index.xml" type="application/rss+xml" title="Tim Trice">
  

  <link rel="manifest" href="../site.webmanifest">
  <link rel="icon" type="image/png" href="../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../img/icon-192.png">

  <link rel="canonical" href="../2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@https://twitter.com/timtrice">
  <meta property="twitter:creator" content="@https://twitter.com/timtrice">
  
  <meta property="og:site_name" content="Tim Trice">
  <meta property="og:url" content="/2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each/">
  <meta property="og:title" content="Query Stack Overflow for Top Five Tags and Top Five Posts Within Each | Tim Trice">
  <meta property="og:description" content="I want to build a query to find the top 5 tags on Stack Overflow and the top 5 posts within each tag. This is a somewhat simple query that utilizes two subqueries AND OVER PARTITION statements.
 Get the top 5 tags (by post count). Get the top 5 posts (by score) for each tag.  I use the Stack Exchange Data Explorer. The tables I focus on are:">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-02-26T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-02-26T00:00:00&#43;00:00">
  

  

  <title>Query Stack Overflow for Top Five Tags and Top Five Posts Within Each - Tim Trice</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="../">Tim Trice</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="../#about">
            
            <span>About</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="../#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="../#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="../#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Query Stack Overflow for Top Five Tags and Top Five Posts Within Each</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-02-26 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Feb 26, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tim Trice">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="../2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../categories/sql">SQL</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Query%20Stack%20Overflow%20for%20Top%20Five%20Tags%20and%20Top%20Five%20Posts%20Within%20Each&amp;url=%2f2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2f2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each%2f&amp;title=Query%20Stack%20Overflow%20for%20Top%20Five%20Tags%20and%20Top%20Five%20Posts%20Within%20Each"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2f2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each%2f&amp;title=Query%20Stack%20Overflow%20for%20Top%20Five%20Tags%20and%20Top%20Five%20Posts%20Within%20Each"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Query%20Stack%20Overflow%20for%20Top%20Five%20Tags%20and%20Top%20Five%20Posts%20Within%20Each&amp;body=%2f2018-02-26-query-stack-overflow-for-top-five-tags-and-top-five-posts-within-each%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <p>I want to build a query to find the top 5 tags on Stack Overflow and the top 5 posts within each tag. This is a somewhat simple query that utilizes two subqueries AND <code>OVER</code> <code>PARTITION</code> statements.</p>
<ul>
<li>Get the top 5 tags (by post count).</li>
<li>Get the top 5 posts (by score) for each tag.</li>
</ul>
<p>I use the <a href="http://data.stackexchange.com/">Stack Exchange Data Explorer</a>. The tables I focus on are:</p>
<ul>
<li>Tags</li>
<li>PostTags</li>
<li>Posts</li>
</ul>
<p>For this particular dataset, I chose to use all three for simplicity. The <code>Tags</code> table has a <code>Count</code> value - the number of posts within the tag. The <code>PostTags</code> table ties both <code>Posts</code> and <code>Tags</code> together by <code>PostId</code> and <code>TagId</code>.</p>
<p><code>Posts</code> does have a <code>tags</code> column, but these contain all tags assigned to the post.</p>
<div id="query" class="section level2">
<h2>Query</h2>
<p>My final query is:</p>
<pre class="sql"><code>SELECT
  PostRanks.Id,
  PostRanks.Score,
  PostRanks.TagId,
  Posts.Title,
  Posts.Tags
FROM (
  SELECT
    Posts.Id,
    Posts.Score,
    PostTags.TagId,
    n = ROW_NUMBER() OVER (
      PARTITION BY
        PostTags.TagId
      ORDER BY
      Posts.Score DESC)
  FROM
    PostTags
  LEFT JOIN
    Posts
  ON
    PostTags.PostId = Posts.Id
  WHERE
    PostTags.TagId IN (
      SELECT
        TOP 5 Tags.Id
      FROM
        Tags
      ORDER BY
        Tags.Count DESC)) AS PostRanks
LEFT JOIN
  Posts
ON Posts.Id = PostRanks.Id
WHERE
  n &lt;= 5
ORDER BY
  PostRanks.TagId,
  PostRanks.Score DESC;</code></pre>
</div>
<div id="results" class="section level2">
<h2>Results</h2>
<p>That produces the dataset:</p>
<table>
<caption><span id="tab:print-df">Table 1: </span>Top 5 Tags and Top 5 Posts Within Each</caption>
<thead>
<tr class="header">
<th align="right">Id</th>
<th align="right">Score</th>
<th align="right">TagId</th>
<th align="left">Title</th>
<th align="left">Tags</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">111102</td>
<td align="right">7659</td>
<td align="right">3</td>
<td align="left">How do JavaScript closures work?</td>
<td align="left">&lt;javascript&gt;&lt;function&gt;&lt;variables&gt;&lt;scope&gt;&lt;closures&gt;</td>
</tr>
<tr class="even">
<td align="right">503093</td>
<td align="right">7595</td>
<td align="right">3</td>
<td align="left">How do I redirect to another webpage?</td>
<td align="left">&lt;javascript&gt;&lt;jquery&gt;&lt;redirect&gt;</td>
</tr>
<tr class="odd">
<td align="right">1789945</td>
<td align="right">7283</td>
<td align="right">3</td>
<td align="left">How to check whether a string contains a substring in JavaScript?</td>
<td align="left">&lt;javascript&gt;&lt;string&gt;&lt;substring&gt;&lt;contains&gt;&lt;string-matching&gt;</td>
</tr>
<tr class="even">
<td align="right">1335851</td>
<td align="right">6405</td>
<td align="right">3</td>
<td align="left">What does “use strict” do in JavaScript, and what is the reasoning behind it?</td>
<td align="left">&lt;javascript&gt;&lt;syntax&gt;&lt;jslint&gt;&lt;use-strict&gt;</td>
</tr>
<tr class="odd">
<td align="right">178325</td>
<td align="right">6367</td>
<td align="right">3</td>
<td align="left">How do I check if an element is hidden in jQuery?</td>
<td align="left">&lt;javascript&gt;&lt;jquery&gt;&lt;dom&gt;&lt;visibility&gt;</td>
</tr>
<tr class="even">
<td align="right">3737139</td>
<td align="right">3556</td>
<td align="right">5</td>
<td align="left">Reference — What does this symbol mean in PHP?</td>
<td align="left">&lt;php&gt;&lt;operators&gt;&lt;symbols&gt;</td>
</tr>
<tr class="odd">
<td align="right">60174</td>
<td align="right">2782</td>
<td align="right">5</td>
<td align="left">How can I prevent SQL injection in PHP?</td>
<td align="left">&lt;php&gt;&lt;mysql&gt;&lt;sql&gt;&lt;security&gt;&lt;sql-injection&gt;</td>
</tr>
<tr class="even">
<td align="right">4366730</td>
<td align="right">2573</td>
<td align="right">5</td>
<td align="left">How do I check if a string contains a specific word?</td>
<td align="left">&lt;php&gt;&lt;string&gt;</td>
</tr>
<tr class="odd">
<td align="right">409286</td>
<td align="right">2147</td>
<td align="right">5</td>
<td align="left">Should I use the datetime or timestamp data type in MySQL?</td>
<td align="left">&lt;php&gt;&lt;mysql&gt;&lt;datetime&gt;&lt;timestamp&gt;&lt;sqldatatypes&gt;</td>
</tr>
<tr class="even">
<td align="right">12859942</td>
<td align="right">2058</td>
<td align="right">5</td>
<td align="left">Why shouldn’t I use mysql_* functions in PHP?</td>
<td align="left">&lt;php&gt;&lt;mysql&gt;&lt;database&gt;</td>
</tr>
<tr class="odd">
<td align="right">7074</td>
<td align="right">4963</td>
<td align="right">9</td>
<td align="left">What is the difference between String and string in C#?</td>
<td align="left">&lt;c#&gt;&lt;.net&gt;&lt;string&gt;&lt;types&gt;</td>
</tr>
<tr class="even">
<td align="right">105372</td>
<td align="right">2958</td>
<td align="right">9</td>
<td align="left">How do I enumerate an enum?</td>
<td align="left">&lt;c#&gt;&lt;.net&gt;&lt;enums&gt;&lt;enumeration&gt;</td>
</tr>
<tr class="odd">
<td align="right">29482</td>
<td align="right">2395</td>
<td align="right">9</td>
<td align="left">Cast int to enum in C#</td>
<td align="left">&lt;c#&gt;&lt;enums&gt;&lt;casting&gt;</td>
</tr>
<tr class="even">
<td align="right">444798</td>
<td align="right">2261</td>
<td align="right">9</td>
<td align="left">Case insensitive ‘Contains(string)’</td>
<td align="left">&lt;c#&gt;&lt;string&gt;&lt;contains&gt;&lt;case-insensitive&gt;</td>
</tr>
<tr class="odd">
<td align="right">247621</td>
<td align="right">1916</td>
<td align="right">9</td>
<td align="left">What are the correct version numbers for C#?</td>
<td align="left">&lt;c#&gt;&lt;.net&gt;&lt;visual-studio&gt;&lt;.net-framework-version&gt;&lt;compiler-version&gt;</td>
</tr>
<tr class="even">
<td align="right">11227809</td>
<td align="right">20632</td>
<td align="right">17</td>
<td align="left">Why is it faster to process a sorted array than an unsorted array?</td>
<td align="left">&lt;java&gt;&lt;c++&gt;&lt;performance&gt;&lt;optimization&gt;&lt;branch-prediction&gt;</td>
</tr>
<tr class="odd">
<td align="right">6841333</td>
<td align="right">5753</td>
<td align="right">17</td>
<td align="left">Why is subtracting these two times (in 1927) giving a strange result?</td>
<td align="left">&lt;java&gt;&lt;date&gt;&lt;timezone&gt;</td>
</tr>
<tr class="even">
<td align="right">40480</td>
<td align="right">5082</td>
<td align="right">17</td>
<td align="left">Is Java “pass-by-reference” or “pass-by-value”?</td>
<td align="left">&lt;java&gt;&lt;methods&gt;&lt;parameter-passing&gt;&lt;pass-by-reference&gt;&lt;pass-by-value&gt;</td>
</tr>
<tr class="odd">
<td align="right">271526</td>
<td align="right">3378</td>
<td align="right">17</td>
<td align="left">Avoiding != null statements</td>
<td align="left">&lt;java&gt;&lt;object&gt;&lt;nullpointerexception&gt;&lt;null&gt;</td>
</tr>
<tr class="even">
<td align="right">8710619</td>
<td align="right">3165</td>
<td align="right">17</td>
<td align="left">Java’s +=, -=, *=, /= compound assignment operators</td>
<td align="left">&lt;java&gt;&lt;casting&gt;&lt;operators&gt;&lt;variable-assignment&gt;&lt;assignment-operator&gt;</td>
</tr>
<tr class="odd">
<td align="right">2025282</td>
<td align="right">4912</td>
<td align="right">1386</td>
<td align="left">What is the difference between “px”, “dip”, “dp” and “sp”?</td>
<td align="left">&lt;android&gt;&lt;android-layout&gt;&lt;user-interface&gt;&lt;dimension&gt;&lt;units-of-measurement&gt;</td>
</tr>
<tr class="even">
<td align="right">1554099</td>
<td align="right">2982</td>
<td align="right">1386</td>
<td align="left">Why is the Android emulator so slow? How can we speed up the Android emulator?</td>
<td align="left">&lt;android&gt;&lt;performance&gt;&lt;android-emulator&gt;&lt;qemu&gt;</td>
</tr>
<tr class="odd">
<td align="right">13375357</td>
<td align="right">2970</td>
<td align="right">1386</td>
<td align="left">Proper use cases for Android UserManager.isUserAGoat()?</td>
<td align="left">&lt;java&gt;&lt;android&gt;&lt;usermanager&gt;</td>
</tr>
<tr class="even">
<td align="right">1109022</td>
<td align="right">2867</td>
<td align="right">1386</td>
<td align="left">Close/hide the Android Soft Keyboard</td>
<td align="left">&lt;android&gt;&lt;android-layout&gt;&lt;android-softkeyboard&gt;&lt;android-input-method&gt;&lt;soft-keyboard&gt;</td>
</tr>
<tr class="odd">
<td align="right">1555109</td>
<td align="right">2217</td>
<td align="right">1386</td>
<td align="left">Stop EditText from gaining focus at Activity startup</td>
<td align="left">&lt;android&gt;&lt;listview&gt;&lt;android-edittext&gt;</td>
</tr>
</tbody>
</table>
<p><a href="http://data.stackexchange.com/stackoverflow/query/810701/top-5-tags-with-overall-posts-and-top-5-posts-within-each-by-score">Source</a></p>
<p>The <code>Score</code> values are slightly off as the dataset used is a little outdated.</p>
</div>
<div id="technique" class="section level2">
<h2>Technique</h2>
<p>First I need to get the tags with the most posts per tag. This initial query is very simple as all of the data already exists within <code>Tags</code>:</p>
<pre class="sql"><code>SELECT 
  TOP 5 Tags.Id
FROM 
  Tags
ORDER BY 
  Tags.Count DESC;</code></pre>
<p>This brings back the values 3, 17, 9, 5, and 1386.</p>
<p>You must add the <code>ORDER BY</code> clause, otherwise you just get the first five rows returned by default.</p>
<p>Now that I know the most popular tags, I need to use <code>PostTags</code> to bridge the gap between <code>Tags</code> and <code>Posts</code>. By finding all <code>PostTags.TagId</code> values of 3, 17, 9, 5 and 1386, I can return all <code>PostTags.PostId</code>.</p>
<p>With the corresponding <code>PostTags.PostId</code> values, I create another query:</p>
<pre class="sql"><code>SELECT
  Posts.Id,
  Posts.Score,
  PostTags.TagId,
  n = ROW_NUMBER() OVER (
    PARTITION BY
      PostTags.TagId
    ORDER BY
    Posts.Score DESC)
FROM
  PostTags
LEFT JOIN
  Posts
ON
  PostTags.PostId = Posts.Id
WHERE
  PostTags.TagId IN (
    SELECT
      TOP 5 Tags.Id
    FROM
      Tags
    ORDER BY
      Tags.Count DESC);</code></pre>
<p>I created a new variable, <code>n</code>, to count every post within each tag ordered by <code>Score</code>. This really serves as my ranking variable. You’ll see in a minute how much easier it will make modifying our result set.</p>
<p>Many, including myself occasionally, get tripped up trying to group results by a column where we may have additional columns in our <code>SELECT</code> statement.</p>
<p>For example, I want the top 5 posts. So, why not just specifically state to return the <code>TOP 5 Posts.Score</code> and have the query <code>GROUP BY</code> <code>PostTags.TagId</code>.</p>
<p>For example, a query like this:</p>
<pre class="sql"><code>SELECT
  TOP 5 Posts.Id,
  Posts.Score,
  PostTags.TagId,
  n = ROW_NUMBER() OVER (
    PARTITION BY
      PostTags.TagId
    ORDER BY
    Posts.Score DESC)
FROM
  PostTags
LEFT JOIN
  Posts
ON
  PostTags.PostId = Posts.Id
WHERE
  PostTags.TagId IN (
    SELECT
      TOP 5 Tags.Id
    FROM
      Tags
    ORDER BY
      Tags.Count DESC)
GROUP BY 
  PostTags.TagId
ORDER BY 
  Posts.Score DESC;</code></pre>
<p>will generate an error like the following:</p>
<blockquote>
<p>Column ‘Posts.Id’ is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>
</blockquote>
<p>What this is telling me is that I have selected more columns than I have specified in my grouping statement. The server recognizes that I’m telling it, “hey, group by tag id and then within each tag id bring me the the post id, post score.” And the server doesn’t know which value of post id or post score to return.</p>
<p>Take a look:</p>
<table>
<thead>
<tr class="header">
<th align="center">Id</th>
<th align="center">Score</th>
<th align="center">TagId</th>
<th align="center">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">111102</td>
<td align="center">7659</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">503093</td>
<td align="center">7595</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">1789945</td>
<td align="center">7283</td>
<td align="center">3</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">1335851</td>
<td align="center">6405</td>
<td align="center">3</td>
<td align="center">4</td>
</tr>
</tbody>
</table>
<p>The server says, “Ok, I grouped everything by <code>TagId</code>. Now, what value of <code>Id</code> and <code>Score</code> am I supposed to return?”</p>
<p>The error will be different depending on the database server. But, generally all servers will, by default, throw an error when you send this type of query.</p>
<p>Back to where I left off, now I have a second subquery that has ranked every post within <code>TagId</code> by <code>Score</code>. The last step is to use this subquery to return my results which was my original query.</p>
<pre class="sql"><code>SELECT
  PostRanks.Id,
  PostRanks.Score,
  PostRanks.TagId,
  Posts.Title,
  Posts.Tags
FROM (
  SELECT
    Posts.Id,
    Posts.Score,
    PostTags.TagId,
    n = ROW_NUMBER() OVER (
      PARTITION BY
        PostTags.TagId
      ORDER BY
      Posts.Score DESC)
  FROM
    PostTags
  LEFT JOIN
    Posts
  ON
    PostTags.PostId = Posts.Id
  WHERE
    PostTags.TagId IN (
      SELECT
        TOP 5 Tags.Id
      FROM
        Tags
      ORDER BY
        Tags.Count DESC)) AS PostRanks
LEFT JOIN
  Posts
ON Posts.Id = PostRanks.Id
WHERE
  n &lt;= 5
ORDER BY
  PostRanks.TagId,
  PostRanks.Score DESC;</code></pre>
<p>By setting <code>WHERE n &lt;= 5</code> I can get the top five posts per tag or, if I want ten or 20 or whatever, just change my condition.</p>
<p>You can also get more tags by changing the first subquery; here:</p>
<pre class="sql"><code>      SELECT
        TOP 5 Tags.Id
      FROM
        Tags
      ORDER BY
        Tags.Count DESC)) AS PostRanks</code></pre>
<p>Just make <code>TOP 5 Tags.Id</code> to whatever you want.</p>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="../tags/select">SELECT</a>
  
  <a class="btn btn-primary btn-outline" href="../tags/row_number">ROW_NUMBER</a>
  
  <a class="btn btn-primary btn-outline" href="../tags/partition">PARTITION</a>
  
  <a class="btn btn-primary btn-outline" href="../tags/left-join">LEFT JOIN</a>
  
  <a class="btn btn-primary btn-outline" href="../tags/order-by">ORDER BY</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="../2017-11-04-department-top-three-salaries/">Department Top Three Salaries</a></li>
        
      </ul>
    </div>
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="../2017-11-04-department-top-three-salaries/" rel="prev">Department Top Three Salaries</a>
  </div>
  
</div>

    </div>
    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "timtrice" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//timtrice.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="../js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

