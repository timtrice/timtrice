---
# General format taken from <https://dev.to/yelluw/how-to-do-technical-blogging>

# Title
#   - Short title, start with verb, provide brief explanation what this is about.
#   - Examples:
#     - Writing a $technology $thing
#     - Developing with $technology
#     - Testing $techonology with $thing
title: HURDAT v0.2.0

# Summary
#   - 2-3 sentences. 
#   - Summarize what post is about.
#   - Should be closely related to title
#   - Should be smooth transition from title
summary: > 
  HURDAT v0.2.0 has recently been released in CRAN. The new release contains all 
  tropical cyclones for the 2017 season, Atlantic and east Pacific basins. 

# Description is not used at this time but may be implemented later.
description: NULL

# Abstract is not used at this time but may be implemented later.
abstract: NULL

author: Tim Trice
date: '2018-06-08'

# Slug
#   - Use title without conjunctions and determiners.
#   - All lower-case.
slug: hurdat-v0.2.0

# Categories
#   - General classification of post.
#     - SQL
#     - R
#     - Python
categories:
  - R
  - HURDAT

output:
    blogdown::html_page:
        toc: true
        toc_depth: 6
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo        =    TRUE, 
                      error       =    TRUE)
```

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(fig.width = 10)
```

```{r libraries}
library(HURDAT)
library(lubridate)
library(tidyverse)
```

## Atlantic Basin

```{r}
AL %>% 
  group_by(Key) %>% 
  summarise(Month = month(first(DateTime))) %>% 
  ggplot(aes(x = Month)) + 
  geom_bar() + 
  scale_x_discrete(labels = c(month.abb), 
                   limits = c(1:12), 
                   expand = c(0.05, 0.05)) + 
  labs(title = "Atlantic Basin Tropical Cyclones", 
       subtitle = sprintf("Cumulative, by month (%s - %s)", 
                          year(first(AL$DateTime)), 
                          year(last(AL$DateTime))), 
       caption = "@timtrice source: HURDAT v0.2.0", 
       y = "Total")
```

```{r}
AL %>% 
  group_by(Key, Year = year(DateTime)) %>% 
  summarise(MaxWind = max(Wind, na.rm = TRUE)) %>% 
  filter(!is.infinite(MaxWind)) %>% 
  mutate(Class = case_when(
    MaxWind <= 33 ~ "TD", 
    MaxWind <= 64 ~ "TS", 
    TRUE          ~ "HU"
  )) %>% 
  group_by(Year, Class) %>% 
  summarise(Storms = n()) %>% 
  spread(Class, Storms) %>% 
  mutate(Total = sum(HU, TD, TS, na.rm = TRUE)) %>% 
  ungroup() %>% 
  top_n(10L, wt = Total) %>% 
  arrange(desc(Total))
```

```{r}
AL %>% 
  group_by(Key, Year = year(DateTime)) %>% 
  summarise(MaxWind = max(Wind, na.rm = TRUE)) %>% 
  filter(!is.infinite(MaxWind)) %>% 
  mutate(Class = case_when(
    MaxWind <= 33 ~ "TD", 
    MaxWind <= 64 ~ "TS", 
    TRUE          ~ "HU"
  )) %>% 
  group_by(Year, Class) %>% 
  summarise(Storms = n()) %>% 
  ggplot(aes(x = Year, y = Storms, fill = Class)) + 
  geom_histogram(stat = "identity") + 
  scale_x_continuous(limits = c(1851, 2017), 
                     breaks = seq(1850, 2020, by = 50), 
                     minor_breaks = seq(1850, 2020, by = 10))
```

```{r}
AL %>%
  select(Wind, Pressure) %>% 
  filter(!is.na(Pressure)) %>% 
  sample_n(size = 1000L) %>% 
  ggplot(aes(x = Wind, y = Pressure)) + 
  geom_point() + 
  geom_smooth(method = "loess")
```

## East Pacific Basin

```{r}
EP %>% 
  group_by(Key) %>% 
  summarise(Month = month(first(DateTime))) %>% 
  ggplot(aes(x = Month)) + 
  geom_bar() + 
  scale_x_discrete(labels = c(month.abb), 
                   limits = c(1:12), 
                   expand = c(0.05, 0.05)) + 
  labs(title = "East Pacific Basin Tropical Cyclones", 
       subtitle = sprintf("Cumulative, by month (%s - %s)", 
                          year(first(EP$DateTime)), 
                          year(last(EP$DateTime))), 
       caption = "@timtrice source: HURDAT v0.2.0", 
       y = "Total")
```

```{r}
EP %>% 
  group_by(Key, Year = year(DateTime)) %>% 
  summarise(MaxWind = max(Wind, na.rm = TRUE)) %>% 
  filter(!is.infinite(MaxWind)) %>% 
  mutate(Class = case_when(
    MaxWind <= 33 ~ "TD", 
    MaxWind <= 64 ~ "TS", 
    TRUE          ~ "HU"
  )) %>% 
  group_by(Year, Class) %>% 
  summarise(Storms = n()) %>% 
  ggplot(aes(x = Year, y = Storms, fill = Class)) + 
  geom_histogram(stat = "identity") + 
  scale_x_continuous(limits = c(1949, 2017), 
                     breaks = seq(1949, 2017, by = 10), 
                     minor_breaks = seq(1949, 2017, by = 5))
```

```{r}
EP %>%
  select(Wind, Pressure) %>% 
  filter(!is.na(Pressure)) %>% 
  sample_n(size = 1000L) %>% 
  ggplot(aes(x = Wind, y = Pressure)) + 
  geom_point() + 
  geom_smooth(method = "loess")
```

