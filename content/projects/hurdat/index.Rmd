---
title: "HURDAT"
description: "Hurricane Re-Analysis Project"
author: "Tim Trice"
tags: ["R", "HURDAT"]
output:
    blogdown::html_page:
        toc: true
---

HURDAT is a R package based off the [Hurricane Re-Analysis Project](http://www.aoml.noaa.gov/hrd/hurdat/Data_Storm.html) by the Hurricane Research Division. The package contains two datasets; one for Atlantic Ocean cyclones and one for northeastern Pacific cyclones. 

## Installation

HURDAT requires R version 3.4.0 or greater.

```{r install, eval = FALSE}
install.packages("HURDAT")
```

```{r hurdat}
library(HURDAT)
```

```{r libraries, message = FALSE, warning = FALSE}
# Additional libraries used for this document
library(dplyr)
library(ggplot2)
library(Hmisc)
library(knitr)
library(purrr)
library(readr)
```

## Included Datasets

The raw dataset is updated annually; typically during late winter or spring. Both included datasets are updated through 2016.

```{r data}
data(AL)
data(EP)
```

### Atlantic (`AL`)

```{r str-al}
str(AL)
```

### Northeast Pacific (`EP`)

The raw dataset for the eastern Pacific actually contains cyclones for the eastern and central Pacific basin. Eastern Pacific cyclones are monitored by the [National Hurricane Center](http://www.nhc.noaa.gov/) while central Pacific cyclones are monitored by the [Central Pacific Hurricane Center](http://www.prh.noaa.gov/cphc/). 

```{r str-ep}
str(EP)
```

## Variables

Here is an explanation of the variables based on the [Atlantic HURDAT codebook](http://www.nhc.noaa.gov/data/hurdat/hurdat2-format-atlantic.pdf):

* `Key`: Primary key or unique identifier for each cyclone. `Key` contains three segements:
    + Basin
    + ATCF cyclone number for that year
    + Year of the cyclone

So the first cyclone of the 2016 Atlantic hurricane season would have the key AL012016. The third cyclone of the 2000 east Pacific hurricane season would have the key EP032000.

* `Name`: Name of cyclone, if given. Names were not assigned to cyclones until the 1950's; "UNNAMED" is default. 

* `DateTime`: The date and time of the observation in UTC.

* `Record`: One of the following, if available:
    + C - Closest approach to a coast without a landfall
    + G - Genesis
    + I - Intensity peak in terms of wind and pressure
    + L - Landfall
    + P - Minimum cetnral pressure
    + R - Provides additional detail on the intensity of the cyclone when rapid changes are underway. 
    + S - Change of status in the system
    + T - Providates additional detail on the track (position) of the cyclone
    + W - Maximum sustained wind speed.

* `Status`: One of the following:
    + TD - Tropical depression (tropical cyclone with winds <34 knots)
    + TS - Tropical storm (tropical cyclone with winds >= 34 knots, < 63 knots)
    + HU - Hurricane (tropical cyclone with winds >= 64 knots)
    + EX - Extratropical cyclone of any intensity
    + SD - Subtropical cyclone with winds < 34 knots
    + SS - Subtropical cyclone with winds >= 34 knots
    + LO - A low pressure system that is neither a tropical cyclone, subtropical cyclone, or extractropical cyclone
    + WV - Tropical wave of any intensity (non-cyclonic)
    + DB - Disturbance of any intensity

* `Lat`: Latitude; positive if in northern hemisphere, else negative.

* `Lon`: Longitude; positive if in eastern hemisphere, else negative.

* `Wind`: maximum sustained wind speed in knots

* `Pressure`: Minimum central pressure in millibars

* `NE34`: Range of winds >= 34 knots in the northeast quadrant

* `SE34`:  Range of winds >= 34 knots in the southeast quadrant

* `SW34`:  Range of winds >= 34 knots in the southwest quadrant

* `NW34`:  Range of winds >= 34 knots in the northwest quadrant

* `NE50`:  Range of winds >= 50 knots in the northeast quadrant

* `SE50`: Range of winds >= 50 knots in the southeast quadrant

* `SW50`: Range of winds >= 50 knots in the southwest quadrant

* `NW50`: Range of winds >= 50 knots in the northwest quadrant

* `NE64`: Range of winds >= 64 knots in the northeast quadrant

* `SE64`: Range of winds >= 64 knots in the southeast quadrant

* `SW64`: Range of winds >= 64 knots in the southwest quadrant

* `NW64`: Range of winds >= 64 knots in the northwest quadrant

## Data Quality

The dataset's previous version had a known issue with some `Lon` values that have not yet been fixed. This particularly stands out in `AL$Lon`:

```{r desc.al.lon}
describe(AL$Lon)
```

For this dataset we expect values between -180 and 0. For Atlantic cyclones `Lon` really be greater than -105; essentially when storms have either disipated or entered the Pacific ocean. 

Let's plot these values and see what we're dealing with.


```{r lat.lon.plot}
ggplot(data = map_data("world"), aes(long, lat, group = group), color = "grey10") + 
    geom_path() + 
    geom_point(data = AL, aes(x = Lon, y = Lat), group = NA, 
               color = "red", size = 0.5) + 
    theme_bw()
```

The two values in `AL$Lon`, -359.1 and -358.4 will need to be fixed. This is an error in the raw dataset:

```{r raw.data.bad.lon}
url <- "http://www.nhc.noaa.gov/data/hurdat/hurdat2-1851-2016-041117.txt"
read_csv(url, skip = 23823L, n_max = 2, col_names = FALSE)
```

The two consecutive observations belong to one particular storm.

```{r al.filter.lon}
AL %>% filter(Lon < -180)
```

```{r AL051952}
AL051952 <- AL %>% 
    filter(Key == "AL051952")
```

```{r plot.AL051952}
ggplot(data = map_data("world"), aes(long, lat, group = group), color = "grey10") + 
    geom_path() + 
    geom_point(data = AL051952, aes(x = Lon, y = Lat), group = NA, 
               color = "red", size = 0.5) + 
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0)) + 
    theme_bw()
```

```{r kable.al051952, results = "asis"}
kable(AL051952 %>% select(DateTime, Lat, Lon), format = "markdown")
```

You can see the tendency is that `Lon` continues to decrease to 0. But once 0 is crossed, instead of continuing in order the longitude values reset to -360. So, really, for the value of -359.1 it should be 0.9 (360 - 359.1). The last value should be 360 - 358.4 or 1.6.

So, to correct these values use the following formula:

$$ Lon = \begin{cases} 360 + Lon, & Lon < -180 \ Lon, & Lon \end{cases} $$

```{r AL051952.correct}
AL051952 <- dmap_at(.d = AL051952, 
             .at = "Lon", 
             .f = function(x) {ifelse(x < -180, 360 + x, x)})
```

```{r}
kable(AL051952 %>% select(DateTime, Lat, Lon), format = "markdown")
```

Corrected plot:

```{r plot.AL051952.corrected}
ggplot(data = map_data("world"), aes(long, lat, group = group), color = "grey10") + 
    geom_path() + 
    geom_point(data = AL051952, aes(x = Lon, y = Lat), group = NA, 
               color = "red", size = 0.5) + 
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0)) + 
    theme_bw()
```

There may be other small errors in the dataset I am not aware of. If you find any please submit an issue to the [GitHub repo](https://github.com/timtrice/HURDAT/issues).
